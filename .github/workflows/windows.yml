name: Windows build

on:
  push:
    branches:
      - "**"
  schedule:
    # '*' is a special character in YAML, so string must be quoted
    - cron: "0 4 * * WED"
  workflow_dispatch:

jobs:
  windows-build:
    name: Windows vcpkg build 
    runs-on: windows-latest

    steps:
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install FEniCSx dependencies
        run: |
          python -m pip install git+https://github.com/FEniCS/basix.git
          python -m pip install git+https://github.com/FEniCS/ufl.git
          python -m pip install git+https://github.com/FEniCS/ffcx.git

      - uses: actions/checkout@v4
        with:
          path: dolfinx

      - name: Build and install DOLFINx C++ library
        working-directory: dolfinx
        run: |
          cmake -G Ninja -B build -S cpp/
          cmake --build build
          sudo cmake --install build

      - name: Build C++ unit tests
        working-directory: dolfinx
        run: |
          cmake -G Ninja -DCMAKE_BUILD_TYPE=Developer -B build/test/ -S cpp/test/
          cmake --build build/test --parallel 3

      - name: Run C++ unit tests (serial)
        working-directory: dolfinx
        run: |
          cd build/test
          ctest -V --output-on-failure -R unittests
      - name: Run C++ unit tests (MPI)
        working-directory: dolfinx
        run: |
          cd build/test
          mpiexec -np 3 ctest -V --output-on-failure -R unittests
